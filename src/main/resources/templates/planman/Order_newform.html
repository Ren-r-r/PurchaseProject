<html lang="en"  xmlns:th="http://www.thymeleaf.org"><head th:replace="~{public::header('录入采购需求')}"><HEAD><meta http-equiv="Content-Language" content="zh-cn"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="GENERATOR" content="Microsoft FrontPage 4.0"><meta name="ProgId" content="FrontPage.Editor.Document"><title>录入采购需求</title></head><body><LINK href="css/style.css" rel=stylesheet><SCRIPT language=JavaScript src="css/pub_Calendar.js"></SCRIPT><table border=0 width=90% align=center><tr><td align=center>选择物资====><font color=red>录入需求计划</font>====>需求计划确认</td></tr></table><center>    <script type="text/javascript" th:inline="none">        $(function () {            $('#dg').datagrid({                url:'/getSelectMaterial',                method:'get',                pagination:true,  //分页工具栏                rownumbers:true,  //显示行号                singleSelect:true, //只允许选中一行                pageSize:4,                pageList:[2,4,6,8,10],                rownumbers:false, //显示行数                onSelect:function(rowIndex, rowData){ //获取对应选中行                    //给页面显示td赋值                    $("#materialNum").html(rowData.materialNum);                    $("#materialName").html(rowData.materialName);                    $("#materialUnit").html(rowData.materialUnit);                    //给隐藏框赋值,便入保存到数据库                    $("#materialNuma").val(rowData.materialNum);                    $("#materialNamea").val(rowData.materialName);                    $("#materialUnita").val(rowData.materialUnit);                },                columns:[[                    {field:'bb',title:'选择',width:80,formatter: function(value,row,index){                            if (row.IsEnable == 1) {                                //如果属性值等于1，则处于选中状态（默认表格中所有单选按钮最多只能有一个值等于1）                                var s = '<input name="isShow" type="radio" checked="checked"/> ';                            }                            else {                                var s = '<input name="isShow" type="radio"/> ';                            }                            return s;                        }},                    {field:'id',title:'编号',width:100},                    {field:'materialNum',title:'产品编码',width:300},                    {field:'materialName',title:'产品名称',width:300,align:'right'},                    {field:'materialUnit',title:'计量单位',width:300},                    {field:'state',title:'状态',width:200,formatter:function (value,row,index) {                            return "<div name=\"state\">未完成</div>";                        }},                ]]            });        })    </script>    <table id="dg"></table>    <form id="addform" name=form  method="post"><TABLE style="LINE-HEIGHT: 30px" cellSpacing=1 cellPadding=0     width="80%"  bgColor=#336699 borderColorLight=#006699 border=0><tr><td><table cellpadding="3" cellspacing="1" border="0" width="100%" id="table2">    <tr class="t1">    <td >物资编码</td>   	    <td id="materialNum">W64001005000</td>   	    <input type="hidden" name="materialNum" id="materialNuma"></tr>    <tr class="t1">    <td >物资名称</td>      	<td id="materialName">晶振(HC-49U-500K-0.005%)</td>        <input type="hidden" name="materialName" id="materialNamea">      	</tr>       <tr class="t1">    <td >数量</td>   	   <td>       <input type="text" name="amount" size="20" maxlength="20"   onKeyPress="check_num_dot()" Chk=2 alt="请输入数量。" onBlur="iszero(this.value,form.p_input11)">       <font color=red>*</font>       </td></tr>    <tr class="t1">    <td >计量单位</td>      	   <td id="materialUnit">个</td>        <input type="hidden" name="materialUnit" id="materialUnita"></tr>    <tr class="t1">    <td >预单价(元)</td>           <td>           <input type="text" name="unitPrice" size="20" maxlength="20" value="5" id="price">      	         	   </td></tr>    <tr class="t1">    <td >交货期</td>      	<td>            <input class="easyui-datetimebox" name="endDate" data-options="required:true,showSeconds:false" style="width:150px">      	      	<font color=red>*</font>      	</td></tr>       <tr class="t1">    <td >备注</td>      	<td>      	<textarea name="remark"></textarea>      	      	</td></tr>    <tr class="t1"> <td colspan=2> <font color=red><B> 附件上传说明：文件大小不能超过4M。 </B></font> </td> </tr></table></td></tr></table><br><input type="button" value="重新选择物资" onClick="window.document.location='pclass_select'"><input type="button" value="保存" onclick='checkstate()'><input type="button" value="全部需求录入完毕" onClick="javascript:submit_form()"></center><input type="hidden" name="p_ordercode" value="1000201011133304"><input type="hidden" name="p_orderno" value="1000201011133304"><input type="hidden" name="p_type" value=""><input type="hidden" name="p_ftype" value="2"></form></body><script LANGUAGE="JAVASCRIPT">    function submit_form(){        var len = document.getElementById("price").value.length;        if(len==0){            alert("单价不能为空");            return false;        }else{            window.location="Order_ytb_list";        }        var len2 = document.getElementById("p_date1").value.length;        if(len2==0){        }else{            window.location="Order_ytb_list";        }    }    function submit_form1(){        var len = document.getElementById("price").value.length;        var addform = document.getElementById("addform");        if(len==0){            alert("单价不能为空");            return false;        }else{            quedingData();            addform.submit();            alert("保存成功，请选择下一条要保存的数据！");        }    }    function quedingData(){        var obj = document.getElementsByName("state");        //var len = obj.length;        var count=0;        var no=0;        var objTable = document.getElementById("dg");        cGetRow=window.event.srcElement.parentElement.parentElement.rowIndex;        var oldTr=objTable.rows[2];        oldTr.cells[5].innerText="完成";    }    function iszero(value,input)    {        if  (value==0)        {            alert("交货期不能为空！");            input.focus();            return;        }    }    function changeData(){        var cGetRow=window.event.srcElement.parentElement.parentElement.rowIndex;        //得到某一行        var oldTr=table1.rows[cGetRow];        var no=oldTr.cells[2].innerText;        var name=oldTr.cells[3].innerText;        var oldTr2=table2.rows[2];        table2.rows[2].cells[1].innerText=no;        table2.rows[3].cells[1].innerText=name;    }    function checkstate() {        var rowsDate=$("#dg").datagrid('getSelected');        var index=$("#dg").datagrid("getRowIndex",rowsDate);        var elementsByName = document.getElementsByName("state");        elementsByName[index].innerHTML="完成";        //获取选中的行        var rows=$("#dg").datagrid('getSelections');        //将选中的行数组转为json        var rows1=JSON.stringify(rows);        if(rows.length>0){            $("#addform").form('submit',{                url:"/addOrder",                onsubmit:function () {                    //    return false;//不能提交                },                success:function (data) {                    $.messager.show({                        title:'系统消息',                        msg:'保存成功!请选择下一条要保存的数据!',                        timeout:3000,                        showType:'slide'                    });                }            });        }    }</script></html>